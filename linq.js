Enumerable=function(){var a=function(a){this.GetEnumerator=a};a.Choice=function(){var c=arguments[0]instanceof Array?arguments[0]:arguments;return new a(function(){return new f(b.Blank,function(){return this.Yield(c[Math.floor(Math.random()*c.length)])},b.Blank)})},a.Cycle=function(){var c=arguments[0]instanceof Array?arguments[0]:arguments;return new a(function(){var a=0;return new f(b.Blank,function(){return a>=c.length&&(a=0),this.Yield(c[a++])},b.Blank)})},a.Empty=function(){return new a(function(){return new f(b.Blank,function(){return!1},b.Blank)})},a.From=function(e){if(null==e)return new j([]);if(e instanceof a)return e;if(typeof e==c.Number||typeof e==c.Boolean)return j(a.Repeat(e,1).ToArray());if(typeof e==c.String)return new a(function(){var a=0;return new f(b.Blank,function(){return a<e.length?this.Yield(e.charAt(a++)):!1},b.Blank)});if(typeof e!=c.Function){if(typeof e.length==c.Number)return new j(e);if(!(e instanceof Object)&&d.IsIEnumerable(e))return new a(function(){var c,a=!0;return new f(function(){c=new Enumerator(e)},function(){return a?a=!1:c.moveNext(),c.atEnd()?!1:this.Yield(c.item())},b.Blank)})}return new a(function(){var a=[],c=0;return new f(function(){for(var b in e)e[b]instanceof Function||a.push({Key:b,Value:e[b]})},function(){return c<a.length?this.Yield(a[c++]):!1},b.Blank)})},a.Return=function(b){return a.Repeat(b,1)},a.Matches=function(c,d,e){return null==e&&(e=""),d instanceof RegExp&&(e+=d.ignoreCase?"i":"",e+=d.multiline?"m":"",d=d.source),-1===e.indexOf("g")&&(e+="g"),new a(function(){var a;return new f(function(){a=new RegExp(d,e)},function(){var b=a.exec(c);return b?this.Yield(b):!1},b.Blank)})},a.Range=function(b,c,d){return null==d&&(d=1),a.ToInfinity(b,d).Take(c)},a.RangeDown=function(b,c,d){return null==d&&(d=1),a.ToNegativeInfinity(b,d).Take(c)},a.RangeTo=function(b,c,d){return null==d&&(d=1),c>b?a.ToInfinity(b,d).TakeWhile(function(a){return c>=a}):a.ToNegativeInfinity(b,d).TakeWhile(function(a){return a>=c})},a.Repeat=function(c,d){return null!=d?a.Repeat(c).Take(d):new a(function(){return new f(b.Blank,function(){return this.Yield(c)},b.Blank)})},a.RepeatWithFinalize=function(b,c){return b=d.CreateLambda(b),c=d.CreateLambda(c),new a(function(){var a;return new f(function(){a=b()},function(){return this.Yield(a)},function(){null!=a&&(c(a),a=null)})})},a.Generate=function(c,e){return null!=e?a.Generate(c).Take(e):(c=d.CreateLambda(c),new a(function(){return new f(b.Blank,function(){return this.Yield(c())},b.Blank)}))},a.ToInfinity=function(c,d){return null==c&&(c=0),null==d&&(d=1),new a(function(){var a;return new f(function(){a=c-d},function(){return this.Yield(a+=d)},b.Blank)})},a.ToNegativeInfinity=function(c,d){return null==c&&(c=0),null==d&&(d=1),new a(function(){var a;return new f(function(){a=c+d},function(){return this.Yield(a-=d)},b.Blank)})},a.Unfold=function(c,e){return e=d.CreateLambda(e),new a(function(){var d,a=!0;return new f(b.Blank,function(){return a?(a=!1,d=c,this.Yield(d)):(d=e(d),this.Yield(d))},b.Blank)})},a.prototype={CascadeBreadthFirst:function(b,c){var e=this;return b=d.CreateLambda(b),c=d.CreateLambda(c),new a(function(){var g,h=0,i=[];return new f(function(){g=e.GetEnumerator()},function(){for(;;){if(g.MoveNext())return i.push(g.Current()),this.Yield(c(g.Current(),h));var e=a.From(i).SelectMany(function(a){return b(a)});if(!e.Any())return!1;h++,i=[],d.Dispose(g),g=e.GetEnumerator()}},function(){d.Dispose(g)})})},CascadeDepthFirst:function(b,c){var e=this;return b=d.CreateLambda(b),c=d.CreateLambda(c),new a(function(){var h,g=[];return new f(function(){h=e.GetEnumerator()},function(){for(;;){if(h.MoveNext()){var e=c(h.Current(),g.length);return g.push(h),h=a.From(b(h.Current())).GetEnumerator(),this.Yield(e)}if(g.length<=0)return!1;d.Dispose(h),h=g.pop()}},function(){try{d.Dispose(h)}finally{a.From(g).ForEach(function(a){a.Dispose()})}})})},Flatten:function(){var c=this;return new a(function(){var e,g=null;return new f(function(){e=c.GetEnumerator()},function(){for(;;){if(null!=g){if(g.MoveNext())return this.Yield(g.Current());g=null}if(e.MoveNext()){if(e.Current()instanceof Array){d.Dispose(g),g=a.From(e.Current()).SelectMany(b.Identity).Flatten().GetEnumerator();continue}return this.Yield(e.Current())}return!1}},function(){try{d.Dispose(e)}finally{d.Dispose(g)}})})},Pairwise:function(b){var c=this;return b=d.CreateLambda(b),new a(function(){var a;return new f(function(){a=c.GetEnumerator(),a.MoveNext()},function(){var c=a.Current();return a.MoveNext()?this.Yield(b(c,a.Current())):!1},function(){d.Dispose(a)})})},Scan:function(b,c,e){if(null!=e)return this.Scan(b,c).Select(e);var g;null==c?(c=d.CreateLambda(b),g=!1):(c=d.CreateLambda(c),g=!0);var h=this;return new a(function(){var a,e,i=!0;return new f(function(){a=h.GetEnumerator()},function(){if(i){if(i=!1,g)return this.Yield(e=b);if(a.MoveNext())return this.Yield(e=a.Current())}return a.MoveNext()?this.Yield(e=c(e,a.Current())):!1},function(){d.Dispose(a)})})},Select:function(b){var c=this;return b=d.CreateLambda(b),new a(function(){var a,e=0;return new f(function(){a=c.GetEnumerator()},function(){return a.MoveNext()?this.Yield(b(a.Current(),e++)):!1},function(){d.Dispose(a)})})},SelectMany:function(b,c){var e=this;return b=d.CreateLambda(b),null==c&&(c=function(a,b){return b}),c=d.CreateLambda(c),new a(function(){var g,h=void 0,i=0;return new f(function(){g=e.GetEnumerator()},function(){if(void 0===h&&!g.MoveNext())return!1;do{if(null==h){var e=b(g.Current(),i++);h=a.From(e).GetEnumerator()}if(h.MoveNext())return this.Yield(c(g.Current(),h.Current()));d.Dispose(h),h=null}while(g.MoveNext());return!1},function(){try{d.Dispose(g)}finally{d.Dispose(h)}})})},Where:function(b){b=d.CreateLambda(b);var c=this;return new a(function(){var a,e=0;return new f(function(){a=c.GetEnumerator()},function(){for(;a.MoveNext();)if(b(a.Current(),e++))return this.Yield(a.Current());return!1},function(){d.Dispose(a)})})},OfType:function(a){var b;switch(a){case Number:b=c.Number;break;case String:b=c.String;break;case Boolean:b=c.Boolean;break;case Function:b=c.Function;break;default:b=null}return null===b?this.Where(function(b){return b instanceof a}):this.Where(function(a){return typeof a===b})},Zip:function(b,c){c=d.CreateLambda(c);var e=this;return new a(function(){var g,h,i=0;return new f(function(){g=e.GetEnumerator(),h=a.From(b).GetEnumerator()},function(){return g.MoveNext()&&h.MoveNext()?this.Yield(c(g.Current(),h.Current(),i++)):!1},function(){try{d.Dispose(g)}finally{d.Dispose(h)}})})},Join:function(c,e,g,h,i){e=d.CreateLambda(e),g=d.CreateLambda(g),h=d.CreateLambda(h),i=d.CreateLambda(i);var j=this;return new a(function(){var k,l,m=null,n=0;return new f(function(){k=j.GetEnumerator(),l=a.From(c).ToLookup(g,b.Identity,i)},function(){for(;;){if(null!=m){var a=m[n++];if(void 0!==a)return this.Yield(h(k.Current(),a));a=null,n=0}if(!k.MoveNext())return!1;var b=e(k.Current());m=l.Get(b).ToArray()}},function(){d.Dispose(k)})})},GroupJoin:function(c,e,g,h,i){e=d.CreateLambda(e),g=d.CreateLambda(g),h=d.CreateLambda(h),i=d.CreateLambda(i);var j=this;return new a(function(){var k=j.GetEnumerator(),l=null;return new f(function(){k=j.GetEnumerator(),l=a.From(c).ToLookup(g,b.Identity,i)},function(){if(k.MoveNext()){var a=l.Get(e(k.Current()));return this.Yield(h(k.Current(),a))}return!1},function(){d.Dispose(k)})})},All:function(a){a=d.CreateLambda(a);var b=!0;return this.ForEach(function(c){return a(c)?void 0:(b=!1,!1)}),b},Any:function(a){a=d.CreateLambda(a);var b=this.GetEnumerator();try{if(0==arguments.length)return b.MoveNext();for(;b.MoveNext();)if(a(b.Current()))return!0;return!1}finally{d.Dispose(b)}},Concat:function(b){var c=this;return new a(function(){var e,g;return new f(function(){e=c.GetEnumerator()},function(){if(null==g){if(e.MoveNext())return this.Yield(e.Current());g=a.From(b).GetEnumerator()}return g.MoveNext()?this.Yield(g.Current()):!1},function(){try{d.Dispose(e)}finally{d.Dispose(g)}})})},Insert:function(b,c){var e=this;return new a(function(){var g,h,i=0,j=!1;return new f(function(){g=e.GetEnumerator(),h=a.From(c).GetEnumerator()},function(){return i==b&&h.MoveNext()?(j=!0,this.Yield(h.Current())):g.MoveNext()?(i++,this.Yield(g.Current())):!j&&h.MoveNext()?this.Yield(h.Current()):!1},function(){try{d.Dispose(g)}finally{d.Dispose(h)}})})},Alternate:function(b){return b=a.Return(b),this.SelectMany(function(c){return a.Return(c).Concat(b)}).TakeExceptLast()},Contains:function(a,b){b=d.CreateLambda(b);var c=this.GetEnumerator();try{for(;c.MoveNext();)if(b(c.Current())===a)return!0;return!1}finally{d.Dispose(c)}},DefaultIfEmpty:function(b){var c=this;return new a(function(){var a,e=!0;return new f(function(){a=c.GetEnumerator()},function(){return a.MoveNext()?(e=!1,this.Yield(a.Current())):e?(e=!1,this.Yield(b)):!1},function(){d.Dispose(a)})})},Distinct:function(b){return this.Except(a.Empty(),b)},Except:function(b,c){c=d.CreateLambda(c);var e=this;return new a(function(){var g,h;return new f(function(){g=e.GetEnumerator(),h=new k(c),a.From(b).ForEach(function(a){h.Add(a)})},function(){for(;g.MoveNext();){var a=g.Current();if(!h.Contains(a))return h.Add(a),this.Yield(a)}return!1},function(){d.Dispose(g)})})},Intersect:function(b,c){c=d.CreateLambda(c);var e=this;return new a(function(){var g,h,i;return new f(function(){g=e.GetEnumerator(),h=new k(c),a.From(b).ForEach(function(a){h.Add(a)}),i=new k(c)},function(){for(;g.MoveNext();){var a=g.Current();if(!i.Contains(a)&&h.Contains(a))return i.Add(a),this.Yield(a)}return!1},function(){d.Dispose(g)})})},SequenceEqual:function(b,c){c=d.CreateLambda(c);var e=this.GetEnumerator();try{var f=a.From(b).GetEnumerator();try{for(;e.MoveNext();)if(!f.MoveNext()||c(e.Current())!==c(f.Current()))return!1;return f.MoveNext()?!1:!0}finally{d.Dispose(f)}}finally{d.Dispose(e)}},Union:function(b,c){c=d.CreateLambda(c);var e=this;return new a(function(){var g,h,i;return new f(function(){g=e.GetEnumerator(),i=new k(c)},function(){var c;if(void 0===h){for(;g.MoveNext();)if(c=g.Current(),!i.Contains(c))return i.Add(c),this.Yield(c);h=a.From(b).GetEnumerator()}for(;h.MoveNext();)if(c=h.Current(),!i.Contains(c))return i.Add(c),this.Yield(c);return!1},function(){try{d.Dispose(g)}finally{d.Dispose(h)}})})},OrderBy:function(a){return new h(this,a,!1)},OrderByDescending:function(a){return new h(this,a,!0)},Reverse:function(){var c=this;return new a(function(){var a,d;return new f(function(){a=c.ToArray(),d=a.length},function(){return d>0?this.Yield(a[--d]):!1},b.Blank)})},Shuffle:function(){var c=this;return new a(function(){var a;return new f(function(){a=c.ToArray()},function(){if(a.length>0){var b=Math.floor(Math.random()*a.length);return this.Yield(a.splice(b,1)[0])}return!1},b.Blank)})},GroupBy:function(b,c,e,g){var h=this;return b=d.CreateLambda(b),c=d.CreateLambda(c),null!=e&&(e=d.CreateLambda(e)),g=d.CreateLambda(g),new a(function(){var a;return new f(function(){a=h.ToLookup(b,c,g).ToEnumerable().GetEnumerator()},function(){for(;a.MoveNext();)return null==e?this.Yield(a.Current()):this.Yield(e(a.Current().Key(),a.Current()));return!1},function(){d.Dispose(a)})})},PartitionBy:function(b,c,e,g){var h=this;b=d.CreateLambda(b),c=d.CreateLambda(c),g=d.CreateLambda(g);var i;return null==e?(i=!1,e=function(a,b){return new m(a,b)}):(i=!0,e=d.CreateLambda(e)),new a(function(){var j,k,l,m=[];return new f(function(){j=h.GetEnumerator(),j.MoveNext()&&(k=b(j.Current()),l=g(k),m.push(c(j.Current())))},function(){for(var d;1==(d=j.MoveNext())&&l===g(b(j.Current()));)m.push(c(j.Current()));if(m.length>0){var f=i?e(k,a.From(m)):e(k,m);return d?(k=b(j.Current()),l=g(k),m=[c(j.Current())]):m=[],this.Yield(f)}return!1},function(){d.Dispose(j)})})},BufferWithCount:function(b){var c=this;return new a(function(){var a;return new f(function(){a=c.GetEnumerator()},function(){for(var c=[],d=0;a.MoveNext();)if(c.push(a.Current()),++d>=b)return this.Yield(c);return c.length>0?this.Yield(c):!1},function(){d.Dispose(a)})})},Aggregate:function(a,b,c){return this.Scan(a,b,c).Last()},Average:function(a){a=d.CreateLambda(a);var b=0,c=0;return this.ForEach(function(d){b+=a(d),++c}),b/c},Count:function(a){a=null==a?b.True:d.CreateLambda(a);var c=0;return this.ForEach(function(b,d){a(b,d)&&++c}),c},Max:function(a){return null==a&&(a=b.Identity),this.Select(a).Aggregate(function(a,b){return a>b?a:b})},Min:function(a){return null==a&&(a=b.Identity),this.Select(a).Aggregate(function(a,b){return b>a?a:b})},MaxBy:function(a){return a=d.CreateLambda(a),this.Aggregate(function(b,c){return a(b)>a(c)?b:c})},MinBy:function(a){return a=d.CreateLambda(a),this.Aggregate(function(b,c){return a(b)<a(c)?b:c})},Sum:function(a){return null==a&&(a=b.Identity),this.Select(a).Aggregate(0,function(a,b){return a+b})},ElementAt:function(a){var b,c=!1;if(this.ForEach(function(d,e){return e==a?(b=d,c=!0,!1):void 0}),!c)throw new Error("index is less than 0 or greater than or equal to the number of elements in source.");return b},ElementAtOrDefault:function(a,b){var c,d=!1;return this.ForEach(function(b,e){return e==a?(c=b,d=!0,!1):void 0}),d?c:b},First:function(a){if(null!=a)return this.Where(a).First();var b,c=!1;if(this.ForEach(function(a){return b=a,c=!0,!1}),!c)throw new Error("First:No element satisfies the condition.");return b},FirstOrDefault:function(a,b){if(null!=b)return this.Where(b).FirstOrDefault(a);var c,d=!1;return this.ForEach(function(a){return c=a,d=!0,!1}),d?c:a},Last:function(a){if(null!=a)return this.Where(a).Last();var b,c=!1;if(this.ForEach(function(a){c=!0,b=a}),!c)throw new Error("Last:No element satisfies the condition.");return b},LastOrDefault:function(a,b){if(null!=b)return this.Where(b).LastOrDefault(a);var c,d=!1;return this.ForEach(function(a){d=!0,c=a}),d?c:a},Single:function(a){if(null!=a)return this.Where(a).Single();var b,c=!1;if(this.ForEach(function(a){if(c)throw new Error("Single:sequence contains more than one element.");c=!0,b=a}),!c)throw new Error("Single:No element satisfies the condition.");return b},SingleOrDefault:function(a,b){if(null!=b)return this.Where(b).SingleOrDefault(a);var c,d=!1;return this.ForEach(function(a){if(d)throw new Error("Single:sequence contains more than one element.");d=!0,c=a}),d?c:a},Skip:function(b){var c=this;return new a(function(){var a,e=0;return new f(function(){for(a=c.GetEnumerator();e++<b&&a.MoveNext(););},function(){return a.MoveNext()?this.Yield(a.Current()):!1},function(){d.Dispose(a)})})},SkipWhile:function(b){b=d.CreateLambda(b);var c=this;return new a(function(){var a,e=0,g=!1;return new f(function(){a=c.GetEnumerator()},function(){for(;!g;){if(!a.MoveNext())return!1;if(!b(a.Current(),e++))return g=!0,this.Yield(a.Current())}return a.MoveNext()?this.Yield(a.Current()):!1},function(){d.Dispose(a)})})},Take:function(b){var c=this;return new a(function(){var a,e=0;return new f(function(){a=c.GetEnumerator()},function(){return e++<b&&a.MoveNext()?this.Yield(a.Current()):!1},function(){d.Dispose(a)})})},TakeWhile:function(b){b=d.CreateLambda(b);var c=this;return new a(function(){var a,e=0;return new f(function(){a=c.GetEnumerator()},function(){return a.MoveNext()&&b(a.Current(),e++)?this.Yield(a.Current()):!1},function(){d.Dispose(a)})})},TakeExceptLast:function(b){null==b&&(b=1);var c=this;return new a(function(){if(0>=b)return c.GetEnumerator();var a,e=[];return new f(function(){a=c.GetEnumerator()},function(){for(;a.MoveNext();){if(e.length==b)return e.push(a.Current()),this.Yield(e.shift());e.push(a.Current())}return!1},function(){d.Dispose(a)})})},TakeFromLast:function(b){if(0>=b||null==b)return a.Empty();var c=this;return new a(function(){var e,g,h=[];return new f(function(){e=c.GetEnumerator()},function(){for(;e.MoveNext();)h.length==b&&h.shift(),h.push(e.Current());return null==g&&(g=a.From(h).GetEnumerator()),g.MoveNext()?this.Yield(g.Current()):!1},function(){d.Dispose(g)})})},IndexOf:function(a){var b=null;return this.ForEach(function(c,d){return c===a?(b=d,!0):void 0}),null!==b?b:-1},LastIndexOf:function(a){var b=-1;return this.ForEach(function(c,d){c===a&&(b=d)}),b},ToArray:function(){var a=[];return this.ForEach(function(b){a.push(b)}),a},ToLookup:function(a,b,c){a=d.CreateLambda(a),b=d.CreateLambda(b),c=d.CreateLambda(c);var e=new k(c);return this.ForEach(function(c){var d=a(c),f=b(c),g=e.Get(d);void 0!==g?g.push(f):e.Add(d,[f])}),new l(e)},ToObject:function(a,b){a=d.CreateLambda(a),b=d.CreateLambda(b);var c={};return this.ForEach(function(d){c[a(d)]=b(d)}),c},ToDictionary:function(a,b,c){a=d.CreateLambda(a),b=d.CreateLambda(b),c=d.CreateLambda(c);var e=new k(c);return this.ForEach(function(c){e.Add(a(c),b(c))}),e},ToJSON:function(a,b){return JSON.stringify(this.ToArray(),a,b)},ToString:function(a,c){return null==a&&(a=""),null==c&&(c=b.Identity),this.Select(c).ToArray().join(a)},Do:function(b){var c=this;return b=d.CreateLambda(b),new a(function(){var a,e=0;return new f(function(){a=c.GetEnumerator()},function(){return a.MoveNext()?(b(a.Current(),e++),this.Yield(a.Current())):!1},function(){d.Dispose(a)})})},ForEach:function(a){a=d.CreateLambda(a);var b=0,c=this.GetEnumerator();try{for(;c.MoveNext()&&a(c.Current(),b++)!==!1;);}finally{d.Dispose(c)}},Write:function(a,b){null==a&&(a=""),b=d.CreateLambda(b);var c=!0;this.ForEach(function(d){c?c=!1:document.write(a),document.write(b(d))})},WriteLine:function(a){a=d.CreateLambda(a),this.ForEach(function(b){document.write(a(b)),document.write("<br />")})},Force:function(){var a=this.GetEnumerator();try{for(;a.MoveNext(););}finally{d.Dispose(a)}},Let:function(b){b=d.CreateLambda(b);var c=this;return new a(function(){var e;return new f(function(){e=a.From(b(c)).GetEnumerator()},function(){return e.MoveNext()?this.Yield(e.Current()):!1},function(){d.Dispose(e)})})},Share:function(){var d,c=this;return new a(function(){return new f(function(){null==d&&(d=c.GetEnumerator())},function(){return d.MoveNext()?this.Yield(d.Current()):!1},b.Blank)})},MemoizeAll:function(){var d,e,c=this;return new a(function(){var a=-1;return new f(function(){null==e&&(e=c.GetEnumerator(),d=[])},function(){return a++,d.length<=a?e.MoveNext()?this.Yield(d[a]=e.Current()):!1:this.Yield(d[a])},b.Blank)})},Catch:function(b){b=d.CreateLambda(b);var c=this;return new a(function(){var a;return new f(function(){a=c.GetEnumerator()},function(){try{return a.MoveNext()?this.Yield(a.Current()):!1}catch(c){return b(c),!1}},function(){d.Dispose(a)})})},Finally:function(b){b=d.CreateLambda(b);var c=this;return new a(function(){var a;return new f(function(){a=c.GetEnumerator()},function(){return a.MoveNext()?this.Yield(a.Current()):!1},function(){try{d.Dispose(a)}finally{b()}})})},Trace:function(a,b){return null==a&&(a="Trace"),b=d.CreateLambda(b),this.Do(function(c){console.log(a,":",b(c))})},Add:function(a){null==this.source&&(this.source=new Array),a instanceof Array?this.source=this.source.concat(a):this.source.push(a)},Delete:function(a){if(null!=this.source){a=d.CreateLambda(a);for(var b=this.GetEnumerator(),c=new Array,e=0;b.MoveNext();)a(b.Current(),null)&&c.push(e),e++;for(id in c){var f=id;id>0&&(f-=id),this.source.splice(c[f],1)}}},Update:function(a,b){if(null!=this.source){a=d.CreateLambda(a);for(var c=this.GetEnumerator(),e=new Array,f=0;c.MoveNext();)a(c.Current(),null)&&e.push(f),f++;if(0!=e.length)if("function"==typeof b)for(id in e)this.source[e[id]]=b(this.source[e[id]]);else for(id in e)this.source[e[id]]=b}}};var b={Identity:function(a){return a},True:function(){return!0},Blank:function(){}},c={Boolean:typeof!0,Number:"number",String:"string",Object:typeof{},Undefined:"undefined",Function:"function"},d={CreateLambda:function(a){if(null==a)return b.Identity;if(typeof a==c.String){if(""==a)return b.Identity;if(-1==a.indexOf("=>"))return new Function("$,$$,$$$,$$$$","return "+a);var d=a.match(/^[(\s]*([^()]*?)[)\s]*=>(.*)/);return new Function(d[1],"return "+d[2])}return a},IsIEnumerable:function(a){if(typeof Enumerator!=c.Undefined)try{return new Enumerator(a),!0}catch(b){}return!1},Compare:function(a,b){return a===b?0:a>b?1:-1},Dispose:function(a){null!=a&&a.Dispose()}},e={Before:0,Running:1,After:2},f=function(a,b,c){var d=new g,f=e.Before;this.Current=d.Current,this.MoveNext=function(){try{switch(f){case e.Before:f=e.Running,a();case e.Running:return b.apply(d)?!0:(this.Dispose(),!1);case e.After:return!1}}catch(c){throw this.Dispose(),c}},this.Dispose=function(){if(f==e.Running)try{c()}finally{f=e.After}}},g=function(){var a=null;this.Current=function(){return a},this.Yield=function(b){return a=b,!0}},h=function(a,b,c,e){this.source=a,this.keySelector=d.CreateLambda(b),this.descending=c,this.parent=e};h.prototype=new a,h.prototype.CreateOrderedEnumerable=function(a,b){return new h(this.source,a,b,this)},h.prototype.ThenBy=function(a){return this.CreateOrderedEnumerable(a,!1)},h.prototype.ThenByDescending=function(a){return this.CreateOrderedEnumerable(a,!0)},h.prototype.GetEnumerator=function(){var c,d,a=this,e=0;return new f(function(){c=[],d=[],a.source.ForEach(function(a,b){c.push(a),d.push(b)});var b=i.Create(a,null);b.GenerateKeys(c),d.sort(function(a,c){return b.Compare(a,c)})},function(){return e<d.length?this.Yield(c[d[e++]]):!1},b.Blank)},h.prototype.UpdateItem=function(a,b){this.source[a]=b};var i=function(a,b,c){this.keySelector=a,this.descending=b,this.child=c,this.keys=null};i.Create=function(a,b){var c=new i(a.keySelector,a.descending,b);return null!=a.parent?i.Create(a.parent,c):c},i.prototype.GenerateKeys=function(a){for(var b=a.length,c=this.keySelector,d=new Array(b),e=0;b>e;e++)d[e]=c(a[e]);this.keys=d,null!=this.child&&this.child.GenerateKeys(a)},i.prototype.Compare=function(a,b){var c=d.Compare(this.keys[a],this.keys[b]);if(0==c){if(null!=this.child)return this.child.Compare(a,b);c=d.Compare(a,b)}return this.descending?-c:c};var j=function(a){this.source=a};j.prototype=new a,j.prototype.Any=function(b){return null==b?this.source.length>0:a.prototype.Any.apply(this,arguments)},j.prototype.Count=function(b){return null==b?this.source.length:a.prototype.Count.apply(this,arguments)},j.prototype.ElementAt=function(b){return b>=0&&b<this.source.length?this.source[b]:a.prototype.ElementAt.apply(this,arguments)},j.prototype.ElementAtOrDefault=function(a,b){return a>=0&&a<this.source.length?this.source[a]:b},j.prototype.First=function(b){return null==b&&this.source.length>0?this.source[0]:a.prototype.First.apply(this,arguments)},j.prototype.FirstOrDefault=function(b,c){return null!=c?a.prototype.FirstOrDefault.apply(this,arguments):this.source.length>0?this.source[0]:b},j.prototype.Last=function(b){return null==b&&this.source.length>0?this.source[this.source.length-1]:a.prototype.Last.apply(this,arguments)},j.prototype.LastOrDefault=function(b,c){return null!=c?a.prototype.LastOrDefault.apply(this,arguments):this.source.length>0?this.source[this.source.length-1]:b},j.prototype.Skip=function(c){var d=this.source;return new a(function(){var a;return new f(function(){a=0>c?0:c},function(){return a<d.length?this.Yield(d[a++]):!1},b.Blank)})},j.prototype.TakeExceptLast=function(a){return null==a&&(a=1),this.Take(this.source.length-a)},j.prototype.TakeFromLast=function(a){return this.Skip(this.source.length-a)},j.prototype.Reverse=function(){var c=this.source;return new a(function(){var a;return new f(function(){a=c.length},function(){return a>0?this.Yield(c[--a]):!1},b.Blank)})},j.prototype.SequenceEqual=function(b,c){return(b instanceof j||b instanceof Array)&&null==c&&a.From(b).Count()!=this.Count()?!1:a.prototype.SequenceEqual.apply(this,arguments)},j.prototype.ToString=function(b,c){return null==c&&this.source instanceof Array?(null==b&&(b=""),this.source.join(b)):a.prototype.ToString.apply(this,arguments)},j.prototype.GetEnumerator=function(){var a=this.source,c=0;return new f(b.Blank,function(){return c<a.length?this.Yield(a[c++]):!1},b.Blank)},j.prototype.UpdateItem=function(a,b){this.source[a]=b};var k=function(){var d=function(a,b){return Object.prototype.hasOwnProperty.call(a,b)},e=function(a){return null===a?"null":void 0===a?"undefined":typeof a.toString===c.Function?a.toString():Object.prototype.toString.call(a)},g=function(a,b){this.Key=a,this.Value=b,this.Prev=null,this.Next=null},h=function(){this.First=null,this.Last=null};h.prototype={AddLast:function(a){null!=this.Last?(this.Last.Next=a,a.Prev=this.Last,this.Last=a):this.First=this.Last=a},Replace:function(a,b){null!=a.Prev?(a.Prev.Next=b,b.Prev=a.Prev):this.First=b,null!=a.Next?(a.Next.Prev=b,b.Next=a.Next):this.Last=b},Remove:function(a){null!=a.Prev?a.Prev.Next=a.Next:this.First=a.Next,null!=a.Next?a.Next.Prev=a.Prev:this.Last=a.Prev}};var i=function(a){this.count=0,this.entryList=new h,this.buckets={},this.compareSelector=null==a?b.Identity:a};return i.prototype={Add:function(a,b){var c=this.compareSelector(a),f=e(c),h=new g(a,b);if(d(this.buckets,f)){for(var i=this.buckets[f],j=0;j<i.length;j++)if(this.compareSelector(i[j].Key)===c)return this.entryList.Replace(i[j],h),void(i[j]=h);i.push(h)}else this.buckets[f]=[h];this.count++,this.entryList.AddLast(h)},Get:function(a){var b=this.compareSelector(a),c=e(b);if(!d(this.buckets,c))return void 0;for(var f=this.buckets[c],g=0;g<f.length;g++){var h=f[g];if(this.compareSelector(h.Key)===b)return h.Value}return void 0},Set:function(a,b){var c=this.compareSelector(a),f=e(c);if(d(this.buckets,f))for(var h=this.buckets[f],i=0;i<h.length;i++)if(this.compareSelector(h[i].Key)===c){var j=new g(a,b);return this.entryList.Replace(h[i],j),h[i]=j,!0}return!1},Contains:function(a){var b=this.compareSelector(a),c=e(b);if(!d(this.buckets,c))return!1;for(var f=this.buckets[c],g=0;g<f.length;g++)if(this.compareSelector(f[g].Key)===b)return!0;return!1},Clear:function(){this.count=0,this.buckets={},this.entryList=new h},Remove:function(a){var b=this.compareSelector(a),c=e(b);if(d(this.buckets,c))for(var f=this.buckets[c],g=0;g<f.length;g++)if(this.compareSelector(f[g].Key)===b)return this.entryList.Remove(f[g]),f.splice(g,1),0==f.length&&delete this.buckets[c],void this.count--},Count:function(){return this.count},ToEnumerable:function(){var c=this;return new a(function(){var a;return new f(function(){a=c.entryList.First},function(){if(null!=a){var b={Key:a.Key,Value:a.Value};return a=a.Next,this.Yield(b)}return!1},b.Blank)})}},i}(),l=function(b){this.Count=function(){return b.Count()},this.Get=function(c){return a.From(b.Get(c))},this.Contains=function(a){return b.Contains(a)},this.ToEnumerable=function(){return b.ToEnumerable().Select(function(a){return new m(a.Key,a.Value)})}},m=function(a,b){this.Key=function(){return a},j.call(this,b)};return m.prototype=new j,a}(),module.exports=Enumerable;